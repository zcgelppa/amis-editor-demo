amis.define("df43798",(function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("849c8c1"),i=e("cc4bbf0"),r=e("3c5b02d"),l=e("af1cc81"),c=e("3c006bc"),s=e("167c905"),d=e("5850c09"),u=e("c2555e3"),p=e("d647ab2"),v=e("8beedab"),b=e("fb32b1a");function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var g=f(i),m=f(l),_=f(c),h=f(d),y=function(e){function t(t){var n=e.call(this,t)||this;Object.defineProperty(n,"target",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"eventPanelSortMap",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(n,"drag",{enumerable:!0,configurable:!0,writable:!0,value:void 0});var a=t.events,o=t.value,i=t.data,r={},l=a[i.type&&"text"!==i.type?i.type:"plain"]||[];return l.forEach((function(e){r[e.eventName]=!0})),n.state={onEvent:null!=o?o:n.generateEmptyDefault(l),events:l,eventPanelActive:r,showAcionDialog:!1,showEventDialog:!1,actionData:void 0,type:"add"},n}return o.__extends(t,e),Object.defineProperty(t.prototype,"componentDidUpdate",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this.props,a=n.value,o=n.onChange;a!==e.value&&this.setState({onEvent:a}),t.onEvent!==this.state.onEvent&&o&&o(this.state.onEvent)}}),Object.defineProperty(t.prototype,"generateEmptyDefault",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t={};return e.forEach((function(e){e.defaultShow&&(t["".concat(e.eventName)]={__isBroadcast:!!e.isBroadcast,weight:0,actions:[]})})),Object.keys(t).length?t:{}}}),Object.defineProperty(t.prototype,"addEvent",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this.props.onChange,a=o.__assign({},this.state.onEvent);t||(a["".concat(e.eventName)]={__isBroadcast:!!e.isBroadcast,weight:0,actions:[]},this.setState({onEvent:a}),n&&n(a))}}),Object.defineProperty(t.prototype,"activeEventDialog",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.debounce?e.debounce=o.__assign({open:!0},e.debounce):e.debounce={open:!1,wait:100},this.setState({eventDialogData:e,showEventDialog:!0})}}),Object.defineProperty(t.prototype,"eventDialogSubmit",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.props.onChange,n=e.eventName,a=e.debounce,i=void 0===a?{}:a,r=o.__assign({},this.state.onEvent),l=r["".concat(n)];i.open?l=o.__assign(o.__assign({},l),{debounce:{wait:i.wait}}):delete l.debounce,r["".concat(n)]=o.__assign({},l),this.setState({onEvent:r,showEventDialog:!1}),t&&t(r)}}),Object.defineProperty(t.prototype,"delEvent",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.props.onChange,n=o.__assign({},this.state.onEvent);delete n[e],this.setState({onEvent:n}),t&&t(n)}}),Object.defineProperty(t.prototype,"addAction",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this.props,a=n.addBroadcast,i=n.owner,r=this.state,l=r.onEvent,c=r.eventPanelActive,s=o.__assign({},l),d=o.__assign({},c);"broadcast"===t.actionType&&"function"==typeof a&&a({owner:i,isBroadcast:!0,eventName:t.eventName,eventLabel:t.eventLabel,description:t.description}),d[e]=!0,t.actionType&&(s[e]=o.__assign(o.__assign({},s[e]),{actions:s[e].actions.concat(t)})),this.setState({onEvent:s,eventPanelActive:d}),this.initDragging(),this.props.onChange&&this.props.onChange(s)}}),Object.defineProperty(t.prototype,"updateAction",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){this.updateValue(e,t,n)}}),Object.defineProperty(t.prototype,"delAction",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){var a,i=this.state,r=i.onEvent,l=i.eventPanelActive,c=this.props.removeBroadcast,s=o.__assign({},r),d=o.__assign({},l);"broadcast"===t.actionType&&"function"==typeof c&&c(t.eventName),s[e]={actions:s[e].actions.filter((function(e,t){return n!==t})),weight:r[e].weight},s[e].actions.length<1&&(d[e]=!1,this.setState({eventPanelActive:d}),null===(a=this.eventPanelSortMap[e])||void 0===a||a.destroy()),this.setState({onEvent:s}),this.props.onChange&&this.props.onChange(s)}}),Object.defineProperty(t.prototype,"toggleActivePanel",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,n=this,a=this.state.eventPanelActive;a[e]=!a[e],a[e]||null===(t=this.eventPanelSortMap[e])||void 0===t||t.destroy(),this.setState({eventPanelActive:a},(function(){n.initDragging()}))}}),Object.defineProperty(t.prototype,"updateWeight",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this.state.onEvent,a=o.__assign({},n);a[e]=o.__assign(o.__assign({},a[e]),{weight:t.weight||0}),this.setState({onEvent:a})}}),Object.defineProperty(t.prototype,"updateValue",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){return o.__awaiter(this,void 0,void 0,(function(){var a,i,r;return o.__generator(this,(function(l){return a=this.state.onEvent,i=o.__assign({},a),r=o.__assign({},a),i[e]={actions:a[e].actions.map((function(e,n){return n===t?{actionType:""}:e})),weight:a[e].weight},r[e]=o.__assign(o.__assign({},a[e]),{actions:a[e].actions.map((function(e,a){return a===t?"string"==typeof n?o.__assign(o.__assign({},e),{actionType:n}):n:e}))}),this.setState({onEvent:r}),this.props.onChange&&this.props.onChange(r),[2]}))}))}}),Object.defineProperty(t.prototype,"dragRef",{enumerable:!1,configurable:!0,writable:!0,value:function(e){!this.drag&&e?this.initDragging():this.drag&&!e&&this.destroyDragging(),this.drag=e}}),Object.defineProperty(t.prototype,"initDragging",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.eventPanelSortMap={};var t=r.findDOMNode(this),n=this.state,a=n.onEvent,o=n.eventPanelActive,i=Array.prototype.slice.call(t.getElementsByClassName("item-content"));Object.keys(a).filter((function(e){return a[e].actions.length&&o[e]})).forEach((function(t,n){e.eventPanelSortMap[t]||(e.eventPanelSortMap[t]=e.genSortPanel(t,i[n]))}))}}),Object.defineProperty(t.prototype,"genSortPanel",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this;return new _.default(t,{group:"eventControlGroup",animation:150,handle:".ae-option-control-item-dragBar",ghostClass:"ae-option-control-item--dragging",onEnd:function(t){if(t.newIndex!==t.oldIndex){var a=t.to;t.newIndex<t.oldIndex&&t.oldIndex<a.childNodes.length-1?a.insertBefore(t.item,a.childNodes[t.oldIndex+1]):t.oldIndex<a.childNodes.length-1?a.insertBefore(t.item,a.childNodes[t.oldIndex]):a.appendChild(t.item);var i=h.default(n.state.onEvent),r=i[e],l=null==r?void 0:r.actions.concat();t.oldIndex>t.newIndex?l=o.__spreadArray(o.__spreadArray(o.__spreadArray(o.__spreadArray([],l.slice(0,t.newIndex),!0),[l[t.oldIndex]],!1),l.slice(t.newIndex,t.oldIndex),!0),l.slice(t.oldIndex+1,l.length),!0):t.oldIndex<t.newIndex&&(l=o.__spreadArray(o.__spreadArray(o.__spreadArray(o.__spreadArray([],0===t.oldIndex?[]:l.slice(0,t.oldIndex),!0),l.slice(t.oldIndex+1,t.newIndex),!0),[l[t.oldIndex]],!1),l.slice(t.newIndex,l.length),!0)),i[e]=o.__assign(o.__assign({},i[e]),{actions:l}),n.setState({onEvent:i})}}})}}),Object.defineProperty(t.prototype,"destroyDragging",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;Object.keys(this.eventPanelSortMap).forEach((function(t){var n;null===(n=e.eventPanelSortMap[t])||void 0===n||n.destroy()}))}}),Object.defineProperty(t.prototype,"getEventVariables",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,n=this.state,a=n.events,i=n.onEvent,r=this.props,l=r.actionTree,c=r.pluginActions,d=r.commonActions,u=r.allComponents,p=i[e.actionData.eventKey].actions;"update"===e.type&&(p=p.slice(0,e.actionData.actionIndex));var f=null==p?void 0:p.filter((function(e){return e.outputVar})),g=null==f?void 0:f.map((function(e,t){var n,a=v.getPropOfAcion(e,"actionLabel",l,c,d,u),i=v.getPropOfAcion(e,"outputVarDataSchema",l,c,d,u),r=new s.DataSchema(i||[]);return{label:"".concat(e.outputVar?e.outputVar+"（".concat(a,"结果）"):"".concat(a,"结果")),tag:"object",children:null===(n=r.getDataPropsAsOptions())||void 0===n?void 0:n.map((function(t){return o.__assign(o.__assign({},t),{value:t.value.replace("${outputVar}",e.outputVar)})}))}})),m=[{label:b.i18n("0b446df580ad309e7c26e5242eddafac"),children:g||[]}],_=a.find((function(t){return t.eventName===e.actionData.eventKey}));return null===(t=null==_?void 0:_.dataSchema)||void 0===t||t.forEach((function(e){var t=new s.DataSchema(e||[]);m[0].children=o.__spreadArray(o.__spreadArray([],m[0].children,!0),t.getDataPropsAsOptions(),!0)})),m}}),Object.defineProperty(t.prototype,"activeActionDialog",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,a,i,r,l,c,d,p,b,f,g,m,_,h,y,E,A,S,P,C;return o.__generator(this,(function(O){switch(O.label){case 0:return t=this.props,n=t.actions,a=t.getContextSchemas,i=t.actionConfigInitFormatter,r=t.getComponents,l=t.actionTree,c=t.allComponents,d=[],a?[4,a()]:[3,2];case 1:p=O.sent(),d=null==p?void 0:p.getDataPropsAsOptions(),O.label=2;case 2:return b=this.getEventVariables(e),f=o.__spreadArray(o.__spreadArray([],b,!0),d,!0),"update"!==e.type?[3,6]:(g=e.actionData.action,[4,null==i?void 0:i(g,{eventVariables:b,rawVariables:d})]);case 3:return m=O.sent(),_=v.findActionNode(l,null==m?void 0:m.actionType),h=v.findSubActionNode(l,g.actionType),y=r(_),E=u.findTree(y,(function(e){return e.value===g.componentId})),A=null,"setValue"===(null==m?void 0:m.actionType)&&(null==E?void 0:E.id)&&v.SELECT_PROPS_CONTAINER.includes((null==E?void 0:E.type)||"")?[4,null==a?void 0:a(E.id,!0)]:[3,5];case 4:S=O.sent(),P=new s.DataSchema(S||[]),C=(null==P?void 0:P.getDataPropsAsOptions())||[],A=null==C?void 0:C.filter((function(e){return"$$id"!==e.value})),O.label=5;case 5:return e.actionData=o.__assign(o.__assign({eventKey:e.actionData.eventKey,actionIndex:e.actionData.actionIndex,variables:f,pluginActions:n,getContextSchemas:a,rawVariables:d},m),{groupType:(null==m?void 0:m.__actionType)||g.actionType,__actionDesc:_.description,__actionSchema:_.schema,__subActions:null==h?void 0:h.actions,__cmptTreeSource:null!=y?y:[],__superCmptTreeSource:c,__setValueDs:A}),setTimeout((function(){var e;return null===(e=document.querySelector(".action-tree li .is-checked"))||void 0===e?void 0:e.scrollIntoView()}),0),[3,7];case 6:e.actionData={eventKey:e.actionData.eventKey,variables:f,pluginActions:n,getContextSchemas:a,rawVariables:d,__superCmptTreeSource:c},O.label=7;case 7:return this.setState(e),[2]}}))}))}}),Object.defineProperty(t.prototype,"renderDesc",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.props,n=t.actions,a=t.actionTree,i=t.commonActions,r=t.getComponents,l=t.allComponents,c=v.getPropOfAcion(e,"descDetail",a,n,i,l),s=o.__assign({},e),d=v.findSubActionNode(a,e.actionType),p=v.getActionType(e,d),b=p&&v.findActionNode(a,p);if(e.componentId&&b){var f=r(b),m=u.findTree(f,(function(t){return t.value===e.componentId}));m&&(s=o.__assign(o.__assign({},s),{rendererLabel:m.label}))}return"function"==typeof c?g.default.createElement("div",{className:"action-control-content"},(null==c?void 0:c(s))||"-"):null}}),Object.defineProperty(t.prototype,"onSubmit",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n,a,o,i=this.props.actionConfigSubmitFormatter,r=null!==(n=null==i?void 0:i(t))&&void 0!==n?n:t;"add"===e?null===(a=this.addAction)||void 0===a||a.call(this,t.eventKey,r):"update"===e&&(null===(o=this.updateAction)||void 0===o||o.call(this,t.eventKey,t.actionIndex,r)),this.setState({showAcionDialog:!1}),this.setState({actionData:void 0})}}),Object.defineProperty(t.prototype,"onClose",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.setState({showAcionDialog:!1})}}),Object.defineProperty(t.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=this.props,n=t.actionTree,a=t.actions,i=t.commonActions,r=t.getComponents,l=t.allComponents,c=t.render,d=this.state,u=d.onEvent,f=d.events,_=d.eventPanelActive,y=d.showAcionDialog,E=d.showEventDialog,A=d.type,S=d.actionData,P=d.eventDialogData,C=h.default(u),O=this.props.showOldEntry,w=Object.keys(C);return g.default.createElement("div",{className:"ae-event-control"},g.default.createElement("header",{className:m.default({"ae-event-control-header":!0,"ae-event-control-header-oldentry":O,"no-bd-btm":!w.length})},c("dropdown",{type:"dropdown-button",level:"enhance",label:b.i18n("1fab2b4934161e87a1f0133b9d5bc1b5"),disabled:!1,className:"block w-full add-event-dropdown",closeOnClick:!0,buttons:f.map((function(t){return{type:"button",disabledTip:b.i18n("3371427f1b82095309092ef82418ec1a"),tooltipPlacement:"left",disabled:Object.keys(u).includes(t.eventName),actionType:"",label:t.eventLabel,onClick:e.addEvent.bind(e,t,Object.keys(u).includes(t.eventName))}}))},{popOverContainer:null})),g.default.createElement("ul",{className:m.default({"ae-event-control-content":!0,"ae-event-control-content-oldentry":O}),ref:this.dragRef},w.length?w.map((function(t,r){var d;return g.default.createElement("li",{className:"event-item",key:"content_".concat(r)},g.default.createElement("div",{className:m.default({"event-item-header":!0,"no-bd-btm":!((null===(d=C[t].actions)||void 0===d?void 0:d.length)&&_[t]||v.getEventStrongDesc(f,t))})},g.default.createElement(s.TooltipWrapper,{tooltipClassName:"event-item-header-tip",trigger:"hover",placement:"top",tooltip:{children:function(){return g.default.createElement("div",null,v.getEventDesc(f,t)||v.getEventStrongDesc(f,t)||t)}}},g.default.createElement("div",null,v.getEventLabel(f,t)||t)),g.default.createElement("div",{className:"event-item-header-toolbar"},g.default.createElement("div",{onClick:e.activeActionDialog.bind(e,{showAcionDialog:!0,type:"add",actionData:{eventKey:t}})},g.default.createElement(s.Icon,{className:"icon",icon:"add-btn"})),g.default.createElement("div",{onClick:e.delEvent.bind(e,t)},g.default.createElement(s.Icon,{className:"icon",icon:"delete-bold-btn"})),g.default.createElement("div",{onClick:e.activeEventDialog.bind(e,o.__assign({eventName:t,eventLabel:v.getEventLabel(f,t)||t},C[t]))},g.default.createElement(s.Icon,{className:"icon",icon:"event-setting"})),g.default.createElement("div",{onClick:e.toggleActivePanel.bind(e,t)},_[t]?g.default.createElement(s.Icon,{className:"icon",icon:"open-btn-r"}):g.default.createElement(s.Icon,{className:"icon",icon:"close-btn"})))),v.getEventStrongDesc(f,t)?c("alert",{type:"alert",body:b.i18n("0e9525b2bb1493c567c114dd61b69095")+v.getEventStrongDesc(f,t),level:"info",showCloseButton:!0,showIcon:!0,className:"event-item-desc"}):null,C[t].actions.length&&_[t]?g.default.createElement("ul",{className:"item-content"},C[t].actions.map((function(o,r){return g.default.createElement("li",{className:"ae-option-control-item",key:"item-content_".concat(r)},g.default.createElement("div",{className:"action-control-header"},g.default.createElement("div",{className:"action-control-header-left"},g.default.createElement("div",{className:"ae-option-control-item-dragBar"},g.default.createElement(s.Icon,{icon:"drag-six-circle-btn",className:"icon"})),g.default.createElement("div",{className:"action-item-actiontype"},v.getPropOfAcion(o,"actionLabel",n,a,i,l)||o.actionType)),g.default.createElement("div",{className:"action-control-header-right"},g.default.createElement("div",{onClick:e.activeActionDialog.bind(e,{showAcionDialog:!0,type:"update",actionData:{action:o,eventKey:t,actionIndex:r}})},g.default.createElement(s.Icon,{className:"icon",icon:"edit-full-btn"})),g.default.createElement("div",{onClick:e.delAction.bind(e,t,o,r)},g.default.createElement(s.Icon,{className:"icon",icon:"delete-easy-btn"})))),e.renderDesc(o))}))):null)})):g.default.createElement("div",{className:"ae-event-control-placeholder"},b.i18n("4db5110d41293fef57f5a1f364187896"))),E?s.render({type:"dialog",title:"".concat(null==P?void 0:P.eventLabel,"-事件配置"),showCloseButton:!1,body:[{type:"form",title:b.i18n("eee1e2258d7ea163fec625ee44be9637"),data:{"&":"$$"},mode:"horizontal",horizontal:{left:3,right:9},body:[{label:b.i18n("5ba999eb762f60324033b735e55d989c"),type:"switch",name:"debounce.open",description:b.i18n("7fe94616be0e8fb5ef5ab40a7397f0aa")},{label:b.i18n("91b72e901f1663637157cda638ac4dcc"),required:!0,hiddenOn:"!debounce.open",name:"debounce.wait",suffix:"ms",max:1e4,min:0,type:"input-number"}],onSubmit:this.eventDialogSubmit.bind(this)}],actions:[{type:"button",label:b.i18n("625fb26b4b3340f7872b411f401e754c"),onEvent:{click:{actions:[{actionType:"custom",script:function(){e.setState({showEventDialog:!1})}}]}}},{type:"button",actionType:"confirm",label:b.i18n("e83a256e4f5bb4ff8b3d804b5473217a"),primary:!0}]},{data:P}):null,g.default.createElement(p.default,{show:y,type:A,actionTree:n,pluginActions:a,commonActions:i,getComponents:r,data:S,onSubmit:this.onSubmit,onClose:this.onClose,render:this.props.render}))}}),o.__decorate([u.autobind,o.__metadata("design:type",Function),o.__metadata("design:paramtypes",[Object]),o.__metadata("design:returntype",void 0)],t.prototype,"dragRef",null),o.__decorate([u.autobind,o.__metadata("design:type",Function),o.__metadata("design:paramtypes",[String,Object]),o.__metadata("design:returntype",void 0)],t.prototype,"onSubmit",null),o.__decorate([u.autobind,o.__metadata("design:type",Function),o.__metadata("design:paramtypes",[]),o.__metadata("design:returntype",void 0)],t.prototype,"onClose",null),t}(g.default.Component);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}o.__extends(t,e),t=o.__decorate([s.FormItem({type:"ae-eventControl"})],t)}(y),t.ACTION_TYPE_TREE=v.ACTION_TYPE_TREE,t.COMMON_ACTION_SCHEMA_MAP=v.COMMON_ACTION_SCHEMA_MAP,t.DATA_CONTAINER=v.DATA_CONTAINER,t.FORMITEM_CMPTS=v.FORMITEM_CMPTS,t.IS_DATA_CONTAINER=v.IS_DATA_CONTAINER,t.SELECT_PROPS_CONTAINER=v.SELECT_PROPS_CONTAINER,t.SHOW_SELECT_PROP=v.SHOW_SELECT_PROP,t.SUPPORT_DISABLED_CMPTS=v.SUPPORT_DISABLED_CMPTS,t.SUPPORT_STATIC_FORMITEM_CMPTS=v.SUPPORT_STATIC_FORMITEM_CMPTS,t.findActionNode=v.findActionNode,t.findSubActionNode=v.findSubActionNode,t.getActionType=v.getActionType,t.getArgsWrapper=v.getArgsWrapper,t.getEventControlConfig=v.getEventControlConfig,t.getEventDesc=v.getEventDesc,t.getEventLabel=v.getEventLabel,t.getEventStrongDesc=v.getEventStrongDesc,t.getOldActionSchema=v.getOldActionSchema,t.getPropOfAcion=v.getPropOfAcion,t.hasActionType=v.hasActionType,t.renderCmptActionSelect=v.renderCmptActionSelect,t.renderCmptSelect=v.renderCmptSelect,t.EventControl=y}));