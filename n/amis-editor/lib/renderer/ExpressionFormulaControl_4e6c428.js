amis.define("5747e90",(function(e,t,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("849c8c1"),o=e("cc4bbf0"),i=e("c2555e3"),l=e("af1cc81"),u=e("167c905"),d=e("2b4d884"),s=e("da84bac"),c=e("fb32b1a");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var m=p(o),f=p(l),b=function(e){function t(t){var a=e.call(this,t)||this;return Object.defineProperty(a,"isUnmount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),a.state={variables:[],formulaPickerValue:""},a}return n.__extends(t,e),Object.defineProperty(t.prototype,"componentDidMount",{enumerable:!1,configurable:!0,writable:!0,value:function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return this.initFormulaPickerValue(this.props.value),[4,s.getVariables(this)];case 1:return e=t.sent(),this.setState({variables:e}),[2]}}))}))}}),Object.defineProperty(t.prototype,"componentDidUpdate",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(a){switch(a.label){case 0:return this.props.data===e.data?[3,2]:[4,s.getVariables(this)];case 1:t=a.sent(),this.setState({variables:t}),a.label=2;case 2:return e.value!==this.props.value&&this.initFormulaPickerValue(this.props.value),[2]}}))}))}}),Object.defineProperty(t.prototype,"componentWillUnmount",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.isUnmount=!0}}),Object.defineProperty(t.prototype,"initFormulaPickerValue",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e;this.props.evalMode&&(t=(null==e?void 0:e.replace(/^\$\{(.*)\}$/,(function(e,t){return t})))||""),this.setState({formulaPickerValue:t})}}),Object.defineProperty(t.prototype,"renderFormulaValue",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t={__html:e.html};return m.default.createElement("span",{dangerouslySetInnerHTML:t})}}),Object.defineProperty(t.prototype,"handleConfirm",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,a;void 0===e&&(e=""),this.props.evalMode&&(e=(e=e.replace(/^\$\{(.*)\}$/,(function(e,t){return t})))?"${".concat(e,"}"):""),null===(a=null===(t=this.props)||void 0===t?void 0:t.onChange)||void 0===a||a.call(t,e)}}),Object.defineProperty(t.prototype,"handleClearExpression",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,a;e.stopPropagation(),e.preventDefault(),null===(a=null===(t=this.props)||void 0===t?void 0:t.onChange)||void 0===a||a.call(t,"")}}),Object.defineProperty(t.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t,a=this,r=this.props,o=r.value,i=r.className,l=r.variableMode,s=r.header,p=n.__rest(r,["value","className","variableMode","header"]),b=this.state,v=b.formulaPickerValue,_=b.variables,h=d.FormulaEditor.highlightValue(v,_)||{html:v},y=null===(t=null===(e=this.props)||void 0===e?void 0:e.data)||void 0===t?void 0:t.name;return m.default.createElement("div",{className:f.default("ae-ExpressionFormulaControl",i)},m.default.createElement(u.PickerContainer,{showTitle:!1,bodyRender:function(e){e.value;var t=e.onChange;return m.default.createElement(d.FormulaEditor,n.__assign({},p,{evalMode:!0,variableMode:l,variables:_,header:s||c.i18n("a9400c408441f1f7f6d6954deb05ae9a"),value:v,onChange:t,selfVariableName:y}))},value:v,onConfirm:this.handleConfirm,size:"md"},(function(e){var t=e.onClick;return v?m.default.createElement(u.Button,{className:"btn-configured",tooltip:{placement:"top",tooltipTheme:"dark",mouseLeaveDelay:20,content:o,tooltipClassName:"btn-configured-tooltip",children:function(){return a.renderFormulaValue(h)}},onClick:t},"已配置表达式",m.default.createElement(u.Icon,{icon:"input-clear",className:"icon",onClick:a.handleClearExpression})):m.default.createElement(m.default.Fragment,null,m.default.createElement(u.Button,{className:"btn-set-expression",onClick:t},"点击编写表达式"))})))}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{variableMode:"tabs",requiredDataPropsVariables:!1,evalMode:!0}}),n.__decorate([i.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[String]),n.__metadata("design:returntype",void 0)],t.prototype,"initFormulaPickerValue",null),n.__decorate([i.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[Object]),n.__metadata("design:returntype",void 0)],t.prototype,"renderFormulaValue",null),n.__decorate([i.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[Object]),n.__metadata("design:returntype",void 0)],t.prototype,"handleConfirm",null),n.__decorate([i.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[Object]),n.__metadata("design:returntype",void 0)],t.prototype,"handleClearExpression",null),t}(m.default.Component);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n.__extends(t,e),t=n.__decorate([u.FormItem({type:"ae-expressionFormulaControl"})],t)}(b),t.default=b}));