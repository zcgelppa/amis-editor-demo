amis.define("064b645",(function(e,a,t,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=e("849c8c1"),l=e("cc4bbf0"),i=e("af1cc81"),o=e("167c905"),d=e("8ba532b"),u=e("c2555e3"),p=e("7f33406"),c=e("fb32b1a");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var b,h=s(l),m=s(i),f=s(p);!function(e){e.CUSTOM="custom",e.API="api"}(b||(b={}));var y=function(e){function a(a){var t=e.call(this,a)||this;Object.defineProperty(t,"$comp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"debounceMapChange",{enumerable:!0,configurable:!0,writable:!0,value:f.default(t.handleMapChange,250)});var n=b.CUSTOM;return a.data.hasOwnProperty("source")&&a.data.source&&(n=b.API),t.state={map:a.data.map,source:a.data.source,labelField:a.data.labelField,valueField:a.data.valueField,mapType:n},t}return r.__extends(a,e),Object.defineProperty(a.prototype,"componentDidUpdate",{enumerable:!1,configurable:!0,writable:!0,value:function(e,a,t){var n,r,l;Array.isArray(null===(n=e.data)||void 0===n?void 0:n.map)!==Array.isArray(null===(r=this.props.data)||void 0===r?void 0:r.map)&&this.setState({map:null===(l=this.props.data)||void 0===l?void 0:l.map})}}),Object.defineProperty(a.prototype,"onChange",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.state,a=e.mapType,t=e.source,n=e.map,r=e.labelField,l=e.valueField,i=this.props.onBulkChange;r=""===r?void 0:r,l=""===l?void 0:l,a!==b.CUSTOM?a!==b.API||i&&i({source:t,map:void 0,labelField:r,valueField:l}):i&&i({map:n,source:void 0,labelField:r,valueField:l})}}),Object.defineProperty(a.prototype,"handleMapTypeChange",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.setState({mapType:e,labelField:void 0,valueField:void 0},this.onChange)}}),Object.defineProperty(a.prototype,"renderHeader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,a=this,t=this.props,n=t.render,l=t.label,i=t.labelRemark,o=t.useMobileUI,d=t.env,u=t.popOverContainer,p=null===(e=null==d?void 0:d.theme)||void 0===e?void 0:e.classPrefix,s=this.state.mapType,f=[{label:c.i18n("01820262aa9ad5b130f8f5b86bfd2968"),value:b.CUSTOM},{label:c.i18n("f99603414a616bdee85de0e6e3938b65"),value:b.API}].map((function(e){return r.__assign(r.__assign({},e),{onClick:function(){return a.handleMapTypeChange(e.value)}})}));return h.default.createElement("header",{className:"ae-OptionControl-header"},h.default.createElement("label",{className:m.default("".concat(p,"Form-label")),style:{marginBottom:0}},l||"",i?n("label-remark",{type:"remark",icon:i.icon||"warning-mark",tooltip:i,className:m.default("Form-lableRemark",null==i?void 0:i.className),useMobileUI:o,container:u||(d&&d.getModalContainer?d.getModalContainer:void 0)}):null),h.default.createElement("div",null,n("validation-control-addBtn",{type:"dropdown-button",level:"link",size:"sm",label:"${selected}",align:"right",closeOnClick:!0,closeOnOutside:!0,buttons:f},{popOverContainer:null,data:{selected:f.find((function(e){return e.value===s})).label}})))}}),Object.defineProperty(a.prototype,"handleMapChange",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.setState({map:e},this.onChange)}}),Object.defineProperty(a.prototype,"handleAPIChange",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.setState({source:e},this.onChange)}}),Object.defineProperty(a.prototype,"handleLabelFieldChange",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.setState({labelField:e},this.onChange)}}),Object.defineProperty(a.prototype,"handleValueFieldChange",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.setState({valueField:e},this.onChange)}}),Object.defineProperty(a.prototype,"renderOtherFields",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[{label:d.tipedLabel("值匹配字段","映射表是数组对象，且对象有多个key时，用来匹配值的字段, 默认为value"),type:"input-text",name:"valueField",placeholder:"匹配字段，默认为value",onChange:this.handleValueFieldChange},{label:d.tipedLabel(c.i18n("7e9c83e86beb612377a94e6e8d1fc644"),"映射表是数组对象时，用作显示的字段，显示多字段请使用自定义显示模板，默认为label"),type:"input-text",name:"labelField",placeholder:"显示字段，默认为label",onChange:this.handleLabelFieldChange,visibleOn:"${!itemSchema}"}]}}),Object.defineProperty(a.prototype,"renderApiPanel",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.props.render,a=this.state,t=a.mapType,n=a.source;return a.labelField,a.valueField,t===b.CUSTOM?null:e("api",d.getSchemaTpl("apiControl",{label:c.i18n("54ea89b497ec3bb319c68844dfa3687f"),name:"source",mode:"normal",className:"ae-ExtendMore",visibleOn:"data.autoComplete !== false",value:n,onChange:this.handleAPIChange,sourceType:t,footer:this.renderOtherFields()}))}}),Object.defineProperty(a.prototype,"renderObjectMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;return(0,this.props.render)("objectMap",d.getSchemaTpl("combo-container",{label:"",type:"combo",mode:"normal",scaffold:{key:"key-{index}",value:"value-{index}"},required:!0,name:"map",descriptionClassName:"help-block text-xs m-b-none",description:"<p>当值命中左侧 Key 时，展示右侧内容<br />当没有命中时，默认展示 Key 为 <code>*</code>的内容</div><br />(请确保key值唯一)",multiple:!0,pipeIn:function(e){if(!u.isObject(e))return[{key:"key0",value:"value1"}];var a=[];return Object.keys(e).forEach((function(t){a.push({key:t||"",value:"string"==typeof e[t]?e[t]:JSON.stringify(e[t])})})),a},pipeOut:function(e){if(!Array.isArray(e))return e;var a={};return e.forEach((function(e,t){var n=e.key||"",r=e.value;"key-{index}"===n&&"value-{index}"===r&&(n=n.replace("-{index}","".concat(t)),r=r.replace("-{index}","".concat(t)));try{r=JSON.parse(r)}catch(e){}a[n]=r})),a},onChange:function(a){e.handleMapChange(a||{"*":c.i18n("2b10dfa6dbdf8775ab2b38fc67e7ea49")})},items:[{placeholder:"Key",type:"input-text",unique:!0,name:"key",required:!0,columnClassName:"w-xs"},{placeholder:c.i18n("2d711b09bd0db0ad240cc83b30dd8014"),type:"input-text",name:"value"}]}))}}),Object.defineProperty(a.prototype,"handleMapItemChange",{enumerable:!1,configurable:!0,writable:!0,value:function(e,a){var t=this.state.map,n=(void 0===t?[]:t).slice();try{a=JSON.parse(a)}catch(e){}n.splice(e,1,a),this.handleMapChange(n)}}),Object.defineProperty(a.prototype,"renderArrayMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,a=this.props.render;return h.default.createElement("div",{className:"ae-ExtendMore"},a("arrayMap",r.__spreadArray([{type:"json-editor",name:"map",label:!1,placeholder:"请保持数组成员结构相同",onChange:function(a){try{var t=JSON.parse(a);e.debounceMapChange(t)}catch(e){console.error()}}}],this.renderOtherFields(),!0)))}}),Object.defineProperty(a.prototype,"renderMap",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.state.map;return e&&Array.isArray(e)?this.renderArrayMap():this.renderObjectMap()}}),Object.defineProperty(a.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.state.mapType,a=this.props.className;return h.default.createElement("div",{className:m.default("ae-OptionControl",a)},this.renderHeader(),e===b.CUSTOM?this.renderMap():this.renderApiPanel())}}),r.__decorate([d.autobind,r.__metadata("design:type",Function),r.__metadata("design:paramtypes",[String]),r.__metadata("design:returntype",void 0)],a.prototype,"handleMapTypeChange",null),r.__decorate([d.autobind,r.__metadata("design:type",Function),r.__metadata("design:paramtypes",[Object]),r.__metadata("design:returntype",void 0)],a.prototype,"handleMapChange",null),r.__decorate([d.autobind,r.__metadata("design:type",Function),r.__metadata("design:paramtypes",[Object]),r.__metadata("design:returntype",void 0)],a.prototype,"handleAPIChange",null),r.__decorate([d.autobind,r.__metadata("design:type",Function),r.__metadata("design:paramtypes",[String]),r.__metadata("design:returntype",void 0)],a.prototype,"handleLabelFieldChange",null),r.__decorate([d.autobind,r.__metadata("design:type",Function),r.__metadata("design:paramtypes",[String]),r.__metadata("design:returntype",void 0)],a.prototype,"handleValueFieldChange",null),a}(h.default.Component);!function(e){function a(){return null!==e&&e.apply(this,arguments)||this}r.__extends(a,e),a=r.__decorate([o.FormItem({type:"ae-mapSourceControl",renderLabel:!1})],a)}(y),a.default=y}));