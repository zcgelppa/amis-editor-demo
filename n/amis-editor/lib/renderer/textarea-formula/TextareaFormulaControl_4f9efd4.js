amis.define("e29351b",(function(e,t,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("849c8c1"),i=e("cc4bbf0"),l=e("af1cc81"),o=e("167c905"),u=e("c2555e3"),s=e("9e5f301"),c=e("4bd06fd"),d=e("1debece"),p=e("7f33406"),f=e("da84bac"),m=e("fb32b1a");function b(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var _=b(i),h=b(l),v=b(s),y=b(p),g=function(e){function t(t){var a=e.call(this,t)||this;return Object.defineProperty(a,"isUnmount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(a,"editorPlugin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(a,"handleOnChange",{enumerable:!0,configurable:!0,writable:!0,value:y.default((function(e){var t,r;null===(r=(t=a.props).onChange)||void 0===r||r.call(t,e)}),200)}),a.state={value:"",variables:[],formulaPickerOpen:!1,formulaPickerValue:"",isFullscreen:!1},a}return n.__extends(t,e),Object.defineProperty(t.prototype,"componentDidMount",{enumerable:!1,configurable:!0,writable:!0,value:function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,f.getVariables(this)];case 1:return e=t.sent(),this.setState({variables:e}),[2]}}))}))}}),Object.defineProperty(t.prototype,"componentDidUpdate",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(a){switch(a.label){case 0:return this.props.data===e.data?[3,2]:[4,f.getVariables(this)];case 1:t=a.sent(),this.setState({variables:t}),a.label=2;case 2:return[2]}}))}))}}),Object.defineProperty(t.prototype,"componentWillUnmount",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.isUnmount=!0}}),Object.defineProperty(t.prototype,"onExpressionClick",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.setState({formulaPickerValue:e,formulaPickerOpen:!0,expressionBrace:t})}}),Object.defineProperty(t.prototype,"closeFormulaPicker",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.setState({formulaPickerOpen:!1})}}),Object.defineProperty(t.prototype,"handleConfirm",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,a=this.state.expressionBrace;e=(e=e.replace(/^\$\{(.*)\}$/,(function(e,t){return t})))?"${".concat(e,"}"):e,null===(t=this.editorPlugin)||void 0===t||t.insertContent(e,"expression",a),this.setState({formulaPickerOpen:!1,expressionBrace:void 0}),this.closeFormulaPicker()}}),Object.defineProperty(t.prototype,"editorFactory",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var a=this.props.variables||this.state.variables;return c.editorFactory(e,t,n.__assign(n.__assign({},this.props),{variables:a}))}}),Object.defineProperty(t.prototype,"handleEditorMounted",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var a=this,r=this.props.variables||this.state.variables;this.editorPlugin=new c.FormulaPlugin(t,e,(function(){return n.__assign(n.__assign({},a.props),{variables:r})}),this.onExpressionClick)}}),Object.defineProperty(t.prototype,"handleFullscreenModeChange",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.props.onOverallClick||this.setState({isFullscreen:!this.state.isFullscreen})}}),Object.defineProperty(t.prototype,"handleFormulaClick",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.props.onOverallClick||this.setState({formulaPickerOpen:!0,formulaPickerValue:"",expressionBrace:void 0})}}),Object.defineProperty(t.prototype,"editorAutoMark",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e;null===(e=this.editorPlugin)||void 0===e||e.autoMark()}}),Object.defineProperty(t.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=this.props,a=t.className;t.header,t.label,t.placeholder;var r=t.height,i=t.additionalMenus,l=t.onOverallClick,u=t.customFormulaPicker,s=n.__rest(t,["className","header","label","placeholder","height","additionalMenus","onOverallClick","customFormulaPicker"]),c=this.state,p=c.value,f=c.formulaPickerOpen,b=c.formulaPickerValue,y=c.isFullscreen,g=c.variables,P=null!=u?u:d.default,k={};return r&&(k.height="".concat(r,"px")),_.default.createElement("div",{className:h.default("ae-TextareaFormulaControl",{"is-fullscreen":this.state.isFullscreen},a)},_.default.createElement("div",{className:h.default("ae-TextareaResultBox"),style:k},_.default.createElement(v.default,{className:"ae-TextareaResultBox-editor",value:p,onChange:this.handleOnChange,editorFactory:this.editorFactory,editorDidMount:this.handleEditorMounted,onBlur:this.editorAutoMark}),_.default.createElement("ul",{className:"ae-TextareaResultBox-footer"},_.default.createElement("li",{className:"ae-TextareaResultBox-footer-fullscreen"},_.default.createElement("a",{className:h.default("Modal-fullscreen"),"data-tooltip":y?m.i18n("49041f245018a6d799fee3c6f177c782"):m.i18n("185926bf986c784d03a9a73102da6542"),"data-position":"top",onClick:this.handleFullscreenModeChange},_.default.createElement(o.Icon,{icon:y?"compress-alt":"expand-alt",className:"icon"}))),_.default.createElement("li",{className:"ae-TextareaResultBox-footer-fxIcon"},_.default.createElement("a",{"data-tooltip":"表达式","data-position":"top",onClick:this.handleFormulaClick},_.default.createElement(o.Icon,{icon:"function",className:"icon"}))),(null==i?void 0:i.length)&&(null==i?void 0:i.map((function(e,t){return _.default.createElement("li",{key:t,className:(null==e?void 0:e.className)||""},e.icon?_.default.createElement("a",{"data-tooltip":e.label,"data-position":"top",onClick:function(){return e.onClick()}},_.default.createElement(o.Icon,{icon:e.icon,className:"icon"})):_.default.createElement("a",{onClick:function(){return null==e?void 0:e.onClick()}},e.label))}))))),l?_.default.createElement("div",{className:h.default("ae-TextareaResultBox-overlay"),onClick:l}):null,f?_.default.createElement(P,n.__assign({},this.props,{value:b,initable:!0,variables:g,variableMode:s.variableMode,evalMode:!0,onClose:function(){return e.setState({formulaPickerOpen:!1})},onConfirm:this.handleConfirm})):null)}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{variableMode:"tabs",requiredDataPropsVariables:!1,height:100}}),n.__decorate([u.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[String,Array]),n.__metadata("design:returntype",void 0)],t.prototype,"onExpressionClick",null),n.__decorate([u.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[]),n.__metadata("design:returntype",void 0)],t.prototype,"closeFormulaPicker",null),n.__decorate([u.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[Object]),n.__metadata("design:returntype",void 0)],t.prototype,"handleConfirm",null),n.__decorate([u.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[HTMLElement,Object]),n.__metadata("design:returntype",void 0)],t.prototype,"editorFactory",null),n.__decorate([u.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[Object,Object]),n.__metadata("design:returntype",void 0)],t.prototype,"handleEditorMounted",null),n.__decorate([u.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[]),n.__metadata("design:returntype",void 0)],t.prototype,"handleFullscreenModeChange",null),n.__decorate([u.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[]),n.__metadata("design:returntype",void 0)],t.prototype,"handleFormulaClick",null),n.__decorate([u.autobind,n.__metadata("design:type",Function),n.__metadata("design:paramtypes",[]),n.__metadata("design:returntype",void 0)],t.prototype,"editorAutoMark",null),t}(_.default.Component);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n.__extends(t,e),t=n.__decorate([o.FormItem({type:"ae-textareaFormulaControl"})],t)}(g),t.TextareaFormulaControl=g}));