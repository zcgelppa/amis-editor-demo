amis.define("fb9c11e",(function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("849c8c1"),r=e("cc4bbf0"),l=e("3c5b02d"),o=e("af1cc81"),d=e("531b2d0"),c=e("3c006bc"),s=e("167c905"),u=e("8ba532b"),m=e("fb32b1a");function b(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=b(r),f=b(o),h=b(d),g=b(c),y=function(e){function t(t){var a=e.call(this,t)||this;return Object.defineProperty(a,"sortable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(a,"drag",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(a,"target",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),a.state={items:t.value,api:t.data.source,source:t.data.source?"api":"custom"},a}return i.__extends(t,e),Object.defineProperty(t.prototype,"handleSourceChange",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.setState({source:e},this.onChange)}}),Object.defineProperty(t.prototype,"handleAPIChange",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.setState({api:e},this.onChange)}}),Object.defineProperty(t.prototype,"onChange",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.state.source,t=this.props.onBulkChange,a={source:void 0,items:void 0};if("custom"===e){var n=this.state.items;a.items=n.map((function(e){return i.__assign({},e)}))}if("api"===e){var r=this.state,l=(n=r.items,r.api);a.items=n.map((function(e){return i.__assign({},e)})),a.source=l}t&&t(a)}}),Object.defineProperty(t.prototype,"toggleEdit",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var a=this.state.items.concat();a[t]=e,this.setState({items:a},this.onChange)}}),Object.defineProperty(t.prototype,"toggleCopy",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.state.items,a=t.concat(t[e]);this.setState({items:a},this.onChange)}}),Object.defineProperty(t.prototype,"toggleDelete",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.state.items.concat();t.splice(e,1),this.setState({items:t},this.onChange)}}),Object.defineProperty(t.prototype,"handleEditLabel",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,a){var n,r=this,l=this.state.items.concat();l.splice(e,1,i.__assign(i.__assign({},l[e]),((n={})[a]=t,n))),this.setState({items:l},(function(){return r.onChange()}))}}),Object.defineProperty(t.prototype,"handleBatchAdd",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var a=this,n=this.state.items.concat(),r=e.batchItems.split("\n").map((function(e){var t=e.trim();if(~t.indexOf(" ")){var a=t.split(" "),n=a[0],i=a[1];return{time:n.trim(),title:i.trim()}}return{label:t,value:t}})),l=h.default(i.__spreadArray(i.__spreadArray([],n,!0),r,!0),"time");this.setState({items:l},(function(){return a.onChange()}))}}),Object.defineProperty(t.prototype,"handleAdd",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.state.items.concat(i.__assign({},e));this.setState({items:t},this.onChange)}}),Object.defineProperty(t.prototype,"buildAddOrEditSchema",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return[{type:"input-text",name:"time",required:!0,placeholder:m.i18n("37087e5bb2d0367872a461f535580d91"),label:m.i18n("19fcb9eb2594059036dfede5f4ec53e8"),value:null==e?void 0:e.time},{type:"input-text",name:"title",required:!0,placeholder:m.i18n("96641a78cfd9f9f8ba68f0524347b186"),label:m.i18n("32c65d8d7431e76029678ec7bb73a5ab"),value:null==e?void 0:e.title},{type:"input-color",name:"color",value:null==e?void 0:e.color,placeholder:m.i18n("02cc4f8f5a9aefbc03c778f7a5c989c7"),label:m.i18n("6b36c6f7ec834692ec6c8e3816349fdd")},u.getSchemaTpl("icon",{value:null==e?void 0:e.icon,placeholder:m.i18n("02cc4f8f5a9aefbc03c778f7a5c989c7"),clearable:!0,description:"",className:"fix-icon-picker-overflow",pipeIn:function(e){return null==e?void 0:e.icon},pipeOut:function(e){if(e)return{type:"icon",vendor:"",icon:e}}})]}}),Object.defineProperty(t.prototype,"buildBatchAddSchema",{enumerable:!1,configurable:!0,writable:!0,value:function(){return{type:"action",actionType:"dialog",label:m.i18n("22de6ef85ed60ec54dbdc1d8583e5104"),dialog:{title:m.i18n("421252e16c6cb544fe9ce0be94a190e0"),headerClassName:"font-bold",closeOnEsc:!0,closeOnOutside:!1,showCloseButton:!0,body:[{type:"alert",level:"warning",body:[{type:"tpl",tpl:m.i18n("1bf14fd24efe68f62bbff0538dee238a")}],showIcon:!0,className:"mb-2.5"},{type:"form",wrapWithPanel:!1,mode:"normal",wrapperComponent:"div",resetAfterSubmit:!0,autoFocus:!0,preventEnterSubmit:!0,horizontal:{left:0,right:12},body:[{name:"batchItems",type:"textarea",label:"",placeholder:m.i18n("1e2f96a69fbef8caa8823a3067ebbdc7"),trimContents:!0,minRows:10,maxRows:50,required:!0}]}]}}}}),Object.defineProperty(t.prototype,"buildAddSchema",{enumerable:!1,configurable:!0,writable:!0,value:function(){return{type:"action",actionType:"dialog",label:m.i18n("e8755fb1e985a5d26df0fce1f0b7b0f8"),active:!0,dialog:{title:m.i18n("d584018521820dac9e92120737b733ba"),headerClassName:"font-bold",closeOnEsc:!0,closeOnOutside:!1,showCloseButton:!0,body:[{type:"form",wrapWithPanel:!1,wrapperComponent:"div",resetAfterSubmit:!0,autoFocus:!0,preventEnterSubmit:!0,horizontal:{justify:!0,left:3,right:9},body:this.buildAddOrEditSchema()}]}}}}),Object.defineProperty(t.prototype,"dragRef",{enumerable:!1,configurable:!0,writable:!0,value:function(e){!this.drag&&e?this.initDragging():this.drag&&!e&&this.destroyDragging(),this.drag=e}}),Object.defineProperty(t.prototype,"initDragging",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=l.findDOMNode(this);this.sortable=new g.default(t.querySelector(".ae-TimelineItemControl-content"),{group:"TimelineItemControlGroup",animation:150,handle:".ae-TimelineItemControlItem-dragBar",ghostClass:"ae-TimelineItemControlItem--dragging",onEnd:function(t){if(t.newIndex!==t.oldIndex){var a=t.to;t.newIndex<t.oldIndex&&t.oldIndex<a.childNodes.length-1?a.insertBefore(t.item,a.childNodes[t.oldIndex+1]):t.oldIndex<a.childNodes.length-1?a.insertBefore(t.item,a.childNodes[t.oldIndex]):a.appendChild(t.item);var n=e.state.items.concat();n[t.oldIndex]=n.splice(t.newIndex,1,n[t.oldIndex])[0],e.setState({items:n},(function(){return e.onChange()}))}}})}}),Object.defineProperty(t.prototype,"destroyDragging",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.sortable&&this.sortable.destroy()}}),Object.defineProperty(t.prototype,"renderHeader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t=this,a=this.props,n=a.render,r=a.label,l=a.labelRemark,o=a.useMobileUI,d=a.env,c=a.popOverContainer,s=null===(e=null==d?void 0:d.theme)||void 0===e?void 0:e.classPrefix,u=this.state.source,b=[{label:m.i18n("01820262aa9ad5b130f8f5b86bfd2968"),value:"custom"},{label:m.i18n("c8158b3cad598b0b5939788ca4efb298"),value:"api"}].map((function(e){return i.__assign(i.__assign({},e),{onClick:function(){return t.handleSourceChange(e.value)}})}));return p.default.createElement("header",{className:"ae-TimelineItemControl-header"},p.default.createElement("label",{className:f.default("".concat(s,"Form-label"))},r||"",l?n("label-remark",{type:"remark",icon:l.icon||"warning-mark",tooltip:l,className:f.default("Form-lableRemark",null==l?void 0:l.className),useMobileUI:o,container:c||(d&&d.getModalContainer?d.getModalContainer:void 0)}):null),p.default.createElement("div",null,n("validation-control-addBtn",{type:"dropdown-button",level:"link",size:"sm",label:"${selected}",align:"right",closeOnClick:!0,closeOnOutside:!0,buttons:b},{popOverContainer:null,data:{selected:b.find((function(e){return e.value===u})).label}})))}}),Object.defineProperty(t.prototype,"renderOption",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,a=e.time,n=e.title,i=e.index,r=!(this.state.items.length>2);return p.default.createElement("li",{className:"ae-TimelineItemControlItem",key:i},p.default.createElement("div",{className:"ae-TimelineItemControlItem-Main"},p.default.createElement("a",{className:"ae-TimelineItemControlItem-dragBar"},p.default.createElement(s.Icon,{icon:"drag-bar",className:"icon"})),p.default.createElement(s.InputBox,{className:"ae-TimelineItemControlItem-input",value:a,placeholder:"请输入显示时间",clearable:!1,onChange:function(e){return t.handleEditLabel(i,e,"time")}}),s.render({type:"dropdown-button",className:"ae-TimelineItemControlItem-dropdown",btnClassName:"px-2",icon:"fa fa-ellipsis-h",hideCaret:!0,closeOnClick:!0,align:"right",menuClassName:"ae-TimelineItemControlItem-ulmenu",buttons:[{type:"action",className:"ae-TimelineItemControlItem-action",label:m.i18n("95b351c86267f3aedf89520959bce689"),actionType:"dialog",dialog:{title:m.i18n("d584018521820dac9e92120737b733ba"),headerClassName:"font-bold",closeOnEsc:!0,closeOnOutside:!1,showCloseButton:!0,body:[{type:"form",wrapWithPanel:!1,wrapperComponent:"div",resetAfterSubmit:!0,autoFocus:!0,preventEnterSubmit:!0,horizontal:{justify:!0,left:3,right:9},body:this.buildAddOrEditSchema(e),onSubmit:function(e){return t.toggleEdit(e,i)}}]}},{type:"button",className:"ae-TimelineItemControlItem-action",label:m.i18n("79d3abe929f67f0644a78bf32adb3a89"),onClick:function(){return t.toggleCopy(i)}},{type:"button",className:"ae-TimelineItemControlItem-action",label:m.i18n("2f4aaddde33c9b93c36fd2503f3d122b"),disabled:r,onClick:function(){return t.toggleDelete(i)}}]},{popOverContainer:null})),p.default.createElement("div",{className:"ae-TimelineItemControlItem-Main"},p.default.createElement(s.InputBox,{className:"ae-TimelineItemControlItem-input-title",value:n,clearable:!1,placeholder:"请输入标题",onChange:function(e){return t.handleEditLabel(i,e,"title")}})))}}),Object.defineProperty(t.prototype,"renderApiPanel",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.props.render,t=this.state,a=t.source,n=t.api;return"api"!==a?null:e("api",u.getSchemaTpl("apiControl",{label:m.i18n("54ea89b497ec3bb319c68844dfa3687f"),name:"source",className:"ae-ExtendMore",visibleOn:"data.autoComplete !== false",value:n,onChange:this.handleAPIChange}))}}),Object.defineProperty(t.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=this.state,a=t.source,n=t.items,r=this.props;r.render;var l=r.className;return p.default.createElement("div",{className:f.default("ae-TimelineItemControl",l)},this.renderHeader(),"custom"===a?p.default.createElement("div",{className:"ae-TimelineItemControl-wrapper"},Array.isArray(n)&&n.length?p.default.createElement("ul",{className:"ae-TimelineItemControl-content",ref:this.dragRef},n.map((function(t,a){return e.renderOption(i.__assign(i.__assign({},t),{index:a}))}))):p.default.createElement("div",{className:"ae-TimelineItemControl-placeholder"},"无选项"),p.default.createElement("div",{className:"ae-TimelineItemControl-footer"},s.render(this.buildAddSchema(),{onSubmit:this.handleAdd}),s.render(this.buildBatchAddSchema(),{onSubmit:this.handleBatchAdd}))):null,this.renderApiPanel())}}),i.__decorate([u.autobind,i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[String]),i.__metadata("design:returntype",void 0)],t.prototype,"handleSourceChange",null),i.__decorate([u.autobind,i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[Object]),i.__metadata("design:returntype",void 0)],t.prototype,"handleAPIChange",null),i.__decorate([u.autobind,i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[Object,Number]),i.__metadata("design:returntype",void 0)],t.prototype,"toggleEdit",null),i.__decorate([u.autobind,i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[Object,Object]),i.__metadata("design:returntype",void 0)],t.prototype,"handleBatchAdd",null),i.__decorate([u.autobind,i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[Object]),i.__metadata("design:returntype",void 0)],t.prototype,"handleAdd",null),i.__decorate([u.autobind,i.__metadata("design:type",Function),i.__metadata("design:paramtypes",[Object]),i.__metadata("design:returntype",void 0)],t.prototype,"dragRef",null),t}(p.default.Component);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}i.__extends(t,e),Object.defineProperty(t.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(){return p.default.createElement(y,i.__assign({},this.props))}}),t=i.__decorate([s.FormItem({type:"ae-timelineItemControl",renderLabel:!1})],t)}(p.default.Component),t.default=y}));